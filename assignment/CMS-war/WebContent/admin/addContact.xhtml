<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
<title> Add Contact</title>
<h:outputStylesheet library="css" name="bootstrap.min.css"></h:outputStylesheet>
</h:head>
<body>
	<div class="navbar-brand">CMS - add a contact for customer
		#{customerContactsController.customerID}</div>

	<h:form id="myform">
		<table class="table table-bordered ">
			<tr>
				<td width="200"><h:outputLabel value="Email" for="Email" /></td>

				<td><h:inputText id="Email" value = "#{customerContactsController.contactToAdd.contactEmail}" title="Email" required="true" type="email" validatorMessage="Please enter a valid Email Address."
							requiredMessage="Please enter an Email address" >
								 <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
					</h:inputText>
										<h:message for="Email" id="message"
						class="#{!Email.valid ? 'badge badge-warning' : 'none'}" />
					</td>


			</tr>

			<tr>
				<td><h:outputLabel value="Contact First Name" for="contactFirstName" /></td>
				<td><h:inputText id="contactFirstName"
						value="#{customerContactsController.contactToAdd.contactFirstName}" title="contactFirstName"
						required="true" requiredMessage="Please enter the first name"
						>
					</h:inputText> 
					<h:message for="contactFirstName"
						class="#{!contactFirstName.valid ? 'badge badge-warning' : 'none'}" />
						</td>

			</tr>

			<tr>
				<td width="200"><h:outputLabel value="Contact Last Name" for="contactLastName" /></td>

				<td><h:inputText id="contactLastName" value = "#{customerContactsController.contactToAdd.contactLastName}" title="contactLastName" required="true"
							requiredMessage="Please enter the last name">
					</h:inputText>
										<h:message for="contactLastName"
						class="#{!contactLastName.valid ? 'badge badge-warning' : 'none'}" />
					</td>


			</tr>
			<tr>
				<td width="200"><h:outputLabel value="Gender"
						for="contactGender" /></td>

				<td><h:selectOneMenu id="contactGender"
						value="#{ customerContactsController.contactToAdd.contactGender }" required = "true" >
						<f:selectItem itemLabel="Select One" />
						<f:selectItem itemLabel="Male" itemValue="M" />
						<f:selectItem itemLabel="Female" itemValue="F" />
						<f:selectItem itemLabel="Other" itemValue="O" />
					</h:selectOneMenu>
										<h:message for="contactGender"
						class="#{!contactGender.valid ? 'badge badge-warning' : 'none'}" />
					
					</td>

			</tr>			
			
			<tr>
				<td width="200"><h:outputLabel value="DOB" for="contactDOB" /></td>

				<td><p:calendar id="contactDOB" value = "#{customerContactsController.contactToAdd.contactDOB}" required="true" showOn="button"
							requiredMessage="Please select a date of birth" navigator="true" pattern = "MM-dd-yyyy">
							<f:convertDateTime pattern = "mm-dd-yyyy" />
							</p:calendar>
							
												<p:message for="contactDOB"
						class="#{!contactDOB.valid ? 'badge badge-warning' : 'none'}" />
								 
					</td>


			</tr>
			
			<tr>
				<td width="200"><h:outputLabel value="Phone number" for="contactPhoneNo" /></td>

				<td><p:inputMask id="contactPhoneNo" mask="0999999999" value = "#{customerContactsController.contactToAdd.contactPhoneNo}" required="true" validatorMessage="Please enter a valid phone number."
							requiredMessage="Please enter a phone number" >
								 <f:validateRegex pattern="[0]\d{9}" />
					</p:inputMask>
										<p:message for="contactPhoneNo"
						class="#{!contactPhoneNo.valid ? 'badge badge-warning' : 'none'}" />
					</td>


			</tr>
			


		</table>
		<h:commandButton id="submit" value="Submit"
			action="#{customerContactsController.addContact(customerContactsController.contactToAdd)}" class="btn btn-primary" >
									<f:param name="customerID"
					value="#{customerContactsController.customerID}" />
		</h:commandButton>

		<h:link id="close" value="Close" outcome="assignContact.xhtml"
			class="btn btn-primary" >
			<f:param name="customerID" value="#{customerContactsController.customerID}" />
			</h:link>
			
		
	</h:form>

<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript">
/* 	https://stackoverflow.com/questions/24710503/how-do-i-post-urlencoded-form-data-with-http-without-jquery 
 *  https://stackoverflow.com/questions/16303779/the-entity-name-must-immediately-follow-the-in-the-entity-reference
	https://www.beyondjava.net/angularfaces-jsf-beyond-ajax
 **/

	
    
   $("#myform\\:Email").keyup(function(){
	        var body = $("#myform\\:Email").val();
	        $.post("/CMS-war/webresources/checkname/contact", {"email" : body} ,function(data){
	        var message = $("#myform\\:message");
	        
	        if(data["exist"]){
	            message.text("Email "+ data["email"] +" already registered");
	            message.addClass("badge badge-warning")
	        }
	        else{
	            message.text("Email " + data["email"] + " available");
	            message.addClass("badge badge-info")
	        }
	        })
	  }
	) 

</script>

</body>
</html>
